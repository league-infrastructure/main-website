---
import type { HTMLAttributes } from 'astro/types';

interface Image {
  src: string;
  alt: string;
}

interface CTA {
  label: string;
  href: string;
  variant?: 'primary' | 'secondary';
  target?: string;
  rel?: string;
}

interface Props extends HTMLAttributes<'article'> {
  title: string;
  level: string;
  description: string;
  highlights: string[];
  price?: string;
  image?: Image;
  cta?: CTA;
  actions?: CTA[];
}

const {
  title,
  level,
  description,
  highlights = [],
  price,
  image,
  cta,
  actions,
  class: className,
  ...rest
} = Astro.props as Props & { class?: string };

const actionList = actions && actions.length > 0 ? actions : cta ? [cta] : [];
---

<article class:list={['card', 'program-card', className]} {...rest}>
  {image && (
    <figure class="card__media">
      <img src={image.src} alt={image.alt} loading="lazy" />
    </figure>
  )}
  <div class="card__body">
    <p class="card__eyebrow">{level}</p>
    <h2>{title}</h2>
    <p>{description}</p>
    <ul>
      {highlights.map((highlight) => (
        <li>{highlight}</li>
      ))}
    </ul>
    {price && <p class="card__price">{price}</p>}
  </div>
  {actionList.length > 0 && (
    <div class="card__footer">
      {(() => {
        const enrollButtons = actionList.filter(action => action.label.includes('Enroll'));
        const learnMoreButton = actionList.find(action => action.label.includes('Learn More'));
        
        return (
          <>
            {enrollButtons.length > 0 && (
              <div class="button-group enrollment-buttons">
                {enrollButtons.map((action) => (
                  <a
                    class:list=[
                      'button',
                      action.variant === 'secondary' ? 'button--secondary' : 'button--primary',
                    ]
                    href={action.href}
                    target={action.target}
                    rel={action.rel}
                  >
                    {action.label}
                  </a>
                ))}
              </div>
            )}
            {learnMoreButton && (
              <div class="button-group learn-more-button">
                <a
                  class:list=[
                    'button',
                    learnMoreButton.variant === 'secondary' ? 'button--secondary' : 'button--primary',
                  ]
                  href={learnMoreButton.href}
                  target={learnMoreButton.target}
                  rel={learnMoreButton.rel}
                >
                  {learnMoreButton.label}
                </a>
              </div>
            )}
          </>
        );
      })()}
    </div>
  )}
</article>
