---
import type { HTMLAttributes } from "astro/types";

interface Props extends HTMLAttributes<"div"> {
  "max-columns"?: number | string;
  maxColumns?: number | string;
  "min-width"?: number | string;
  minWidth?: number | string;
}

const props = Astro.props as Props & { class?: string; style?: string };
const { class: className, style: inlineStyle, ...rest } = props;

const hyphenMax = props["max-columns"];
const camelMax = props.maxColumns;
const parsedMax = Number(hyphenMax ?? camelMax);
const hasCustomColumns = Number.isFinite(parsedMax) && parsedMax > 0;
const columnCount = hasCustomColumns
  ? Math.max(1, Math.floor(Number(parsedMax)))
  : null;

const rawMin = props["min-width"] ?? props.minWidth;
const parsedMin = Number(rawMin);
const minWidthPx = Number.isFinite(parsedMin) && parsedMin > 0 ? parsedMin : 300;

delete (rest as Record<string, unknown>)["max-columns"];
delete (rest as Record<string, unknown>).maxColumns;
delete (rest as Record<string, unknown>)["min-width"];
delete (rest as Record<string, unknown>).minWidth;

const classes = ["card-grid"];
if (className) {
  classes.push(className);
}

const styleParts: string[] = [];
if (inlineStyle && inlineStyle.trim().length > 0) {
  styleParts.push(inlineStyle.trim().replace(/;$/, ""));
}
styleParts.push(`--card-grid-min-width: ${minWidthPx}px`);
if (columnCount) {
  styleParts.push(
    `--card-grid-template: repeat(${columnCount}, minmax(var(--card-grid-min-width, 300px), 1fr))`
  );
}
const styleValue = styleParts.join("; ");
---

<div class:list={classes} style={styleValue} {...rest}>
  <slot />
</div>

<style>

  .card-grid {
    display: grid;
    gap: var(--space-xl);
    width: 100%;
    grid-template-columns: var(
      --card-grid-template,
      repeat(auto-fit, minmax(var(--card-grid-min-width, 300px), 1fr))
    );
  }

  @media (max-width: 600px) {
    .card-grid {
      gap: var(--space-lg);
    }
  }
</style>
