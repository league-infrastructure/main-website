---
import Section from "./Section.astro";
import SectionHeader from "./SectionHeader.astro";
import { pike13_base_url, pike13_client_id, local_timezone } from "../content/config";

interface Props {
  serviceId?: number | string | null;
  heading?: string;
  baseUrl?: string;
  clientId?: string;
  localTz?: string;
}

const {
  serviceId = null,
  heading = "Pike13 Events",
  baseUrl = pike13_base_url,
  clientId = pike13_client_id,
  localTz = local_timezone,
} = Astro.props as Props;

const normalizedServiceId = (() => {
  if (typeof serviceId === "number" && Number.isFinite(serviceId)) {
    return String(Math.trunc(serviceId));
  }
  if (typeof serviceId === "string" && serviceId.trim().length > 0) {
    return serviceId.trim();
  }
  return "";
})();

const initialMessage = normalizedServiceId ? "Loading events..." : "No Pike13 service configured.";
---

<Section
  class="pike13-events"
  data-component="pike13-events"
  data-service-id={normalizedServiceId}
  data-base-url={baseUrl}
  data-client-id={clientId}
  data-local-tz={localTz}
>
  <SectionHeader>
    <h2>{heading}</h2>
  </SectionHeader>
  <div class="pike13-events__output">{initialMessage}</div>
  <template data-pike13-item-template>
    <slot />
  </template>
</Section>
</Section>

<script>
  import "../scripts/pike13-events-client";
</script>

<style>
  .pike13-events__output {
    background: var(--color-surface-alt, #f5f5f5);
    border-radius: var(--radius-lg, 16px);
    padding: var(--space-lg, 24px);
  }

  .pike13-events__list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: var(--space-sm, 12px);
  }

  .pike13-events__item {
    background: var(--color-surface, #fff);
    border: 1px solid var(--color-border, #e5e5e5);
    border-radius: var(--radius-md, 12px);
    padding: var(--space-md, 16px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md, 16px);
  }

  .pike13-events__name {
    font-weight: 600;
  }

  .pike13-events__meta {
    color: var(--color-text-muted, #666);
    font-variant-numeric: tabular-nums;
  }
</style>
