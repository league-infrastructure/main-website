---
import Section from "./Section.astro";
import SectionHeader from "./SectionHeader.astro";

interface Props {
  serviceId?: number | string | null;
  heading?: string;
}

const {
  serviceId = null,
  heading = "Pike13 Events",
} = Astro.props as Props;

const normalizedServiceId = (() => {
  if (typeof serviceId === "number" && Number.isFinite(serviceId)) {
    return String(Math.trunc(serviceId));
  }
  if (typeof serviceId === "string" && serviceId.trim().length > 0) {
    return serviceId.trim();
  }
  return "";
})();

const initialMessage = normalizedServiceId ? "Loading events..." : "No Pike13 service configured.";
const eventsScriptSrc = (await import("../scripts/pike13-events-client.ts?url")).default;
---

<Section
  class="pike13-events"
  data-component="pike13-events"
  data-service-id={normalizedServiceId}
>
  <SectionHeader>
    <h2>{heading}</h2>
  </SectionHeader>
  <pre class="pike13-events__output">{initialMessage}</pre>
  <script type="module" src={eventsScriptSrc} is:inline></script>
</Section>

<style>
  .pike13-events__output {
    background: var(--color-surface-alt, #f5f5f5);
    border-radius: var(--radius-lg, 16px);
    padding: var(--space-lg, 24px);
    font-family: var(--font-mono, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace);
    font-size: 0.875rem;
    line-height: 1.5;
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }
</style>
