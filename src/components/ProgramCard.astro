---
import type { HTMLAttributes } from 'astro/types';

interface Props extends HTMLAttributes<'article'> {
  img: string;
  alt: string;
  href?: string;
}

const { class: className, img, alt, href, ...rest } = Astro.props as Props & { class?: string };
const hasCardDirectory = img.includes('/cards/');
const fallbackStyle = hasCardDirectory ? undefined : 'height: 190px; padding-top: 15px;';
---

<article class:list={['card', 'program-card', className]} {...rest}>
  <figure class="card__media">
    {href ? (
      <a href={href} class="card__media-link">
        <img src={img} alt={alt} loading="lazy" style={fallbackStyle} />
      </a>
    ) : (
      <img src={img} alt={alt} loading="lazy" style={fallbackStyle} />
    )}
  </figure>
  <slot />
</article>

<style>
  .program-card {
    gap: 0;
    height: 100%;
  }

  .card__media {
    margin: 0;
    width: 100%;
    aspect-ratio: 7 / 4;

    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
  }

  .card__media-link {
    display: flex;
    width: 100%;
    height: 100%;
  }

  .card__media img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }

  :global(.card-grid) .program-card {
    display: flex;
    flex-direction: column;
  }

  :global(.card-grid) .program-card :global(.card__body) {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  :global(.card-grid) .program-card :global(.card__footer) {
    margin-top: auto;
    width: 100%;
  }
</style>
