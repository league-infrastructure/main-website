---
import type { HTMLAttributes } from "astro/types";
import Button from "./Button.astro";

interface CTA {
  label: string;
  href: string;
  variant?: "primary" | "secondary" | "outline" | "ghost";
  target?: string;
  rel?: string;
}

interface Props extends HTMLAttributes<"article"> {
  title?: string;
  eyebrow?: string;
  headingLevel?: 2 | 3 | 4 | 5 | 6;
  cta?: CTA;
  items?: string[];
  itemsClass?: string;
}

const {
  title,
  eyebrow,
  headingLevel = 3,
  cta,
  items,
  itemsClass,
  class: className,
  ...rest
} = Astro.props as Props & { class?: string };

const safeHeadingLevel = Math.min(Math.max(headingLevel, 2), 6);
const hasMedia = Astro.slots.has("media");
const hasFooter = Astro.slots.has("footer");
---

<article class:list={["card", "callout-card", className]} {...rest}>
  {
    hasMedia && (
      <div class="callout-card__media">
        <slot name="media" />
      </div>
    )
  }
  <div class="card__body callout-card__body">
    {eyebrow && <p class="card__eyebrow">{eyebrow}</p>}
    {title && safeHeadingLevel === 2 && <h2 class="card__title">{title}</h2>}
    {title && safeHeadingLevel === 3 && <h3 class="card__title">{title}</h3>}
    {title && safeHeadingLevel === 4 && <h4 class="card__title">{title}</h4>}
    {title && safeHeadingLevel === 5 && <h5 class="card__title">{title}</h5>}
    {title && safeHeadingLevel === 6 && <h6 class="card__title">{title}</h6>}
    {
      items && items.length > 0 && (
        <ul class:list={["card__list", itemsClass]}>
          {items.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      )
    }
    <slot />
  </div>
  {
    (cta || hasFooter) && (
      <div class="card__footer callout-card__footer">
        {cta && (
          <Button
            class="card__cta"
            href={cta.href}
            variant={cta.variant ?? "primary"}
            target={cta.target}
            rel={cta.rel}
          >
            {cta.label}
          </Button>
        )}
        {hasFooter && (
          <div class="callout-card__footer-slot">
            <slot name="footer" />
          </div>
        )}
      </div>
    )
  }
</article>

<style>
  .callout-card {
    display: flex;
    flex-direction: column;
    gap: 0;
    height: 100%;
  }

  .callout-card__media {
    display: block;
    overflow: hidden;
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
  }

  .callout-card__media :global(*) {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .callout-card__body {
    display: grid;
    gap: var(--space-md);
    padding: var(--space-xl);
    flex: 1;
  }

  .callout-card__body > :where(p,
      ul,
      ol,
      h2,
      h3,
      h4,
      h5,
      h6) {
    margin: 0;
  }

  .callout-card__footer {
    display: grid;
    gap: var(--space-sm);
    padding: 0 var(--space-xl) var(--space-xl);
    margin-top: auto;
  }

  .callout-card__footer-slot {
    width: 100%;
  }

  .callout-card__footer-slot :global(*) {
    display: inline-flex;
    justify-content: center;
    width: 100%;
    text-align: center;
  }

  .callout-card :global(.link) {
    text-align: center;
    display: block;
  }
</style>
