---
import { siteSettings, socialLinks } from '../data/siteSettings';
import { mainNavigation } from '../data/navigation';

type SocialIconMeta = { letter: string; color: string };

const socialIconMap: Record<string, SocialIconMeta> = {
  facebook: { letter: 'F', color: '#1877F2' },
  twitter: { letter: 'X', color: '#111111' },
  instagram: { letter: 'IG', color: '#E1306C' },
  youtube: { letter: 'YT', color: '#FF0000' },
  linkedin: { letter: 'IN', color: '#0A66C2' },
};

const decoratedSocialLinks = socialLinks.map((item) => {
  const iconKey = item.icon ?? item.label.toLowerCase();
  const meta: SocialIconMeta = socialIconMap[iconKey] ?? {
    letter: item.label.slice(0, 2).toUpperCase(),
    color: 'var(--color-primary)',
  };

  return {
    ...item,
    iconKey,
    iconMeta: meta,
  };
});
---

<footer class="footer">
  <div class="container">
    <div class="footer__grid">
      <div>
        <h3 class="footer__heading">{siteSettings.shortName}</h3>
        <p>
          We prepare young people for the science and technology careers of the 21st century through
          real coding education, professional mentorship, and project-based learning.
        </p>
      </div>
      <div>
        <h4 class="footer__heading">Visit &amp; Contact</h4>
        <address>
          <p>
            {siteSettings.address}<br />
            <a href={siteSettings.directionsUrl} rel="noreferrer">Get directions</a>
          </p>
          <p>
            <a href={siteSettings.phoneHref}>{siteSettings.phone}</a><br />
            <a href={`mailto:${siteSettings.email}`}>{siteSettings.email}</a>
          </p>
        </address>
      </div>
      <div>
        <h4 class="footer__heading">Explore</h4>
        <ul class="list-reset footer__links">
          {mainNavigation.map((item) => (
            <li>
              <a
                href={item.href}
                target={item.external ? '_blank' : undefined}
                rel={item.external ? 'noreferrer' : undefined}
              >
                {item.label}
              </a>
            </li>
          ))}
          <li><a href="/donate/volunteer/">Volunteer</a></li>
          <li><a href="/donate/create-a-fundraiser/">Create a Fundraiser</a></li>
        </ul>
      </div>

      <div>
        <h4 class="footer__heading">Stay Connected</h4>
        <ul class="list-reset footer__links footer__links--social">
          {decoratedSocialLinks.map((item) => (
            <li>
              <a href={item.href} target="_blank" rel="noreferrer" aria-label={item.label}>
                <svg
                  class={`social-icon social-icon--${item.iconKey}`}
                  viewBox="0 0 48 48"
                  aria-hidden="true"
                  focusable="false"
                >
                  <circle cx="24" cy="24" r="24" fill={item.iconMeta.color} />
                  <text
                    x="24"
                    y="27"
                    text-anchor="middle"
                    font-size="18"
                    font-family="'Inter', 'Helvetica Neue', Arial, sans-serif"
                    font-weight="700"
                    fill="#ffffff"
                  >
                    {item.iconMeta.letter}
                  </text>
                </svg>
                <span class="sr-only">{item.label}</span>
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
    <div class="footer__bottom">
      <span>Â© {new Date().getFullYear()} {siteSettings.name}. 501(c)(3) Tax ID: 20-4744610.</span>
      <span class="footer__policies">
        <a href="/about/policies/nondiscrimination-policy/">Nondiscrimination Policy</a>
        <a href="/about/policies/privacy-policy/">Privacy Policy</a>
        <a href="/images/2021/11/LOAP_SafeReopeningPlan.pdf" target="_blank" rel="noreferrer">Safe Reopening Plan</a>

      </span>
    </div>
  </div>
</footer>

<style>
  .footer {
    background: var(--color-surface-alt);
    padding: 0;
    margin-top: 0;
  }

  .footer__grid {
    display: grid;
    gap: var(--space-xl);
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .footer__heading {
    margin-top: 0;
    margin-bottom: var(--space-md);
    color: var(--color-text);
  }

  .footer address {
    font-style: normal;
    color: var(--color-body);
  }

  .footer__links {
    display: grid;
    gap: var(--space-xs);
  }

  .footer__links--social {
    display: flex;
    gap: var(--space-sm);
  }

  .footer__links--social li {
    margin: 0;
  }

  .footer__links--social a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .footer__links--social a:hover .social-icon,
  .footer__links--social a:focus .social-icon {
    transform: scale(1.05);
  }

  .footer__links--social a:focus-visible .social-icon {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
  }

  .social-icon {
    width: 40px;
    height: 40px;
    transition: transform 0.2s ease;
  }

  .footer__links a {
    color: var(--color-body);
  }

  .footer__links a:hover,
  .footer__links a:focus {
    color: var(--color-primary);
  }

  .footer__bottom {
    margin-top: 0;
    padding-top: 0;
    border-top: 1px solid var(--color-border);
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    align-items: center;
    justify-content: space-between;
    color: var(--color-muted);
    font-size: 14px;
  }

  .footer__policies {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
  }

  .footer__policies a {
    color: var(--color-muted);
  }

  @media (max-width: 640px) {
    .footer__bottom {
      align-items: flex-start;
      flex-direction: column;
    }
  }
</style>
