---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeader from '../../components/SectionHeader.astro';
import HeroSection from '../../components/ui/HeroSection.astro';
import ProgramCard from '../../components/ui/ProgramCard.astro';
import CalloutCard from '../../components/ui/CalloutCard.astro';
import { load } from 'js-yaml';
import programsSource from './_index.yaml?raw';

// Parse YAML via raw import so the dev server watches updates to the source file.
const yamlContent = load(programsSource) as Record<string, any>;
---


<BaseLayout
  title={yamlContent.base_layout.title}
  description={yamlContent.base_layout.description}
>
  <HeroSection
    class={yamlContent.hero_section.class}
    title={yamlContent.hero_section.title}
    description={yamlContent.hero_section.description}
    note={yamlContent.hero_section.note}
    details={yamlContent.hero_section.details}
    actions={yamlContent.hero_section.actions}
  >
    <figure slot="media" class="programs-hero__media">
      <img src={yamlContent.hero_section.media.image.src} alt={yamlContent.hero_section.media.image.alt} loading="lazy" />
    </figure>
  </HeroSection>

  <section class={yamlContent.main_programs.section.class}>
    <div class="container">
      <SectionHeader
        title={yamlContent.main_programs.section.header.title}
        description={yamlContent.main_programs.section.header.description}
      />
      <div class="program-grid">
        {yamlContent.main_programs.section.program_grid.map((program: any) => (
          <ProgramCard
            title={program.title}
            level={program.level}
            description={program.description}
            highlights={program.highlights}
            price={program.price}
            image={program.image}
            cta={{ label: program.cta, href: program.link, variant: 'secondary' }}
          />
        ))}
      </div>
    </div>
  </section>

  <section class={yamlContent.program_comparison.section.class}>
    <div class="container">
      <SectionHeader
        title={yamlContent.program_comparison.section.header.title}
        description={yamlContent.program_comparison.section.header.description}
      />
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              {yamlContent.program_comparison.section.table.headers.map((header: string) => (
                <th scope="col">{header}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {yamlContent.program_comparison.section.table.rows.map((row: any) => (
              <tr>
                <th scope="row">
                  <a href={row.link}>{row.program}</a>
                </th>
                <td>{row.level}</td>
                <td>{row.duration}</td>
                <td>{row.tuition}</td>
                <td>{row.assistance}</td>
                <td>{row.schedule}</td>
                <td>{row.ratio}</td>
                <td>{row.languages}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class={yamlContent.other_programs.section.class}>
    <div class="container">
      <SectionHeader
        title={yamlContent.other_programs.section.header.title}
        description={yamlContent.other_programs.section.header.description}
      />
      <div class="support-grid">
        {yamlContent.other_programs.section.support_grid.map((program: any) => (
          <CalloutCard class="support-card" title={program.title}>
            <p>{program.description}</p>
            <a slot="footer" class="link" href={program.href}>Learn more</a>
          </CalloutCard>
        ))}
      </div>
    </div>
  </section>

  <section class={yamlContent.why_highlights.section.class}>
    <div class="container split-grid">
      {yamlContent.why_highlights.section.split_grid.map((highlight: any) => (
        <CalloutCard class="split-card" title={highlight.title}>
          <p>{highlight._content}</p>
        </CalloutCard>
      ))}
    </div>
  </section>

  <section class={yamlContent.start_options.section.class}>
    <div class="container cta">
      <div class="cta__copy">
        <h2>{yamlContent.start_options.section.cta.copy.title}</h2>
        <p>{yamlContent.start_options.section.cta.copy.description}</p>
        <a class="button" href={yamlContent.start_options.section.cta.copy.action.href}>{yamlContent.start_options.section.cta.copy.action.label}</a>
      </div>
      <figure class="cta__media">
        <img src={yamlContent.start_options.section.cta.media.image.src} alt={yamlContent.start_options.section.cta.media.image.alt} loading="lazy" />
      </figure>
    </div>
  </section>
</BaseLayout>
