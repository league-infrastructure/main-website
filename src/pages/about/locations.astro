---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Section from '../../components/Section.astro';
import CardGrid from '../../components/CardGrid.astro';
import LocationCard from '../../components/LocationCard.astro';
import { locations, type Location } from '../../data/locations';

const contactQuickLinks = [
  { label: 'About', href: '/about/' },
  { label: 'Programs', href: '/programs/' },
  { label: 'Curriculum', href: 'https://curriculum.jointheleague.org/', external: true },
  { label: 'News', href: '/news/' },
  { label: 'Policies', href: '/about/policies/' },
  { label: 'Supporters', href: '/donate/supporters/' },
  { label: 'Volunteer with The League', href: '/donate/volunteer/' },
  { label: 'Create a fundraiser', href: '/donate/create-a-fundraiser/' }
];

const contactSocialLinks = [
  { label: 'Facebook', href: 'https://www.facebook.com/LeagueOfAmazingProgrammers' },
  { label: 'Twitter', href: 'https://twitter.com/LEAGUEofAmazing' },
  { label: 'Instagram', href: 'https://www.instagram.com/theleagueofamazingprogrammers/' },
  { label: 'YouTube', href: 'https://www.youtube.com/channel/UCkUULukaHTW8ljTXKXXGE5A' },
  { label: 'LinkedIn', href: 'https://www.linkedin.com/company/the-league-of-amazing-programmers' }
];

const cleanLocationName = (name: string) =>
  name
    .replace(/\s*\([^)]*\)\s*$/u, '')
    .replace(/\s{2,}/g, ' ')
    .trim();

const sortByName = (a: Location, b: Location) =>
  cleanLocationName(a.name).localeCompare(cleanLocationName(b.name));

const formatAddress = (location: Location): string => {
  const formattedAddress = location.formatted_address ?? '';
  const primaryAddress = location.address ?? '';

  if (formattedAddress.trim().length > 0) {
    return formattedAddress;
  }

  if (primaryAddress.trim().length > 0) {
    return primaryAddress;
  }

  const cityLine = [location.city, location.state_code, location.postal_code]
    .filter(Boolean)
    .join(', ');

  if (cityLine.length > 0) {
    return cityLine;
  }

  if (location.latitude === null && location.longitude === null) {
    return 'Online';
  }

  return 'Details coming soon';
};

const labelType = (type: Location['type'] | null | undefined, fallback = 'Other Location') => {
  switch (type) {
    case 'league':
      return 'League Site';
    case 'school':
      return 'School';
    case 'library':
      return 'Library';
    default:
      return fallback;
  }
};

const leagueLocations = locations.filter((location) => location.type === 'league').sort(sortByName);
const schoolLocations = locations.filter((location) => location.type === 'school').sort(sortByName);
const libraryLocations = locations.filter((location) => location.type === 'library').sort(sortByName);
const otherLocations = locations.filter((location) => !location.type).sort(sortByName);
---

<BaseLayout
  title="Locations"
  description="Explore The League of Amazing Programmers classroom locations and partner sites across San Diego."
>
  <Section
    id="contact"
    class="locations-contact"
    containerClass="locations-contact__container"
  >
    <div class="locations-contact__intro">
      <span class="tag">Get in Touch</span>
      <h1>Contact The League</h1>
      <p>
        Reach out with questions about classes, donations, or partnerships and our team will connect you to the right person. We typically respond within two business days.
      </p>
    </div>
    <CardGrid class="locations-contact__grid" min-width={260}>
      <article class="card">
        <h2>Visit &amp; Call</h2>
        <p>
          12625 High Bluff Drive #113<br />
          San Diego, CA 92130
        </p>
        <p>
          <strong>Phone:</strong> <a href="tel:18582840481">(858) 284-0481</a><br />
          <strong>Email:</strong> <a href="mailto:info@jointheleague.org">info@jointheleague.org</a>
        </p>
        <a class="button" href="https://goo.gl/maps/GUdss2BayCqGmDCLA" target="_blank" rel="noreferrer">Get Directions</a>
      </article>
      <article class="card">
        <h2>Quick Links</h2>
        <ul class="list-reset locations-contact__links">
          {contactQuickLinks.map((item) => (
            <li>
              <a
                href={item.href}
                target={item.external ? '_blank' : undefined}
                rel={item.external ? 'noreferrer' : undefined}
              >
                {item.label}
              </a>
            </li>
          ))}
        </ul>
      </article>
      <article class="card">
        <h2>Follow The League</h2>
        <ul class="list-reset locations-contact__links">
          {contactSocialLinks.map((item) => (
            <li>
              <a href={item.href} target="_blank" rel="noreferrer">{item.label}</a>
            </li>
          ))}
        </ul>
      </article>
    </CardGrid>
    <article class="card locations-contact__message">
      <h2>Send Us a Message</h2>
      <p>
        Email <a href="mailto:info@jointheleague.org">info@jointheleague.org</a> with your name, the best way to reach you, and how we can help.
      </p>
    </article>
  </Section>

  <section class="section hero">
    <div class="container locations__feature">
  <h2>Class Locations</h2>
      <p>
        The League teaches across San Diego County with a mix of in-person and online classes. Our Carmel Valley campus is the main hub for weekly programming classes, while Tech Club and special events take place across libraries, recreation centers, and partner organizations.
      </p>
    </div>
  </section>

  <section class="section section--surface-alt">
    <div class="container locations__grid">
      <article class="card">
        <h2>The League Headquarters</h2>
        <p>
          12625 High Bluff Drive #113<br />
          San Diego, CA 92130
        </p>
        <p class="locations__note">
          Weekly Python and Java classes meet at our Carmel Valley classroom.
        </p>
        <div class="locations__links">
          <a class="button" href="https://goo.gl/maps/GUdss2BayCqGmDCLA" target="_blank" rel="noreferrer">Get Directions</a>
          <a class="button button--secondary" href="mailto:info@jointheleague.org">Email Us</a>
        </div>
      </article>

      <article class="card">
        <h2>Online Classes</h2>
        <p>
          Live online Python and Java classes offered weekly via Zoom.
        </p>
        <p class="locations__note">
          All virtual sessions use video conferencing and collaborative coding platforms.
        </p>
      </article>

      <article class="card">
        <h2>Tech Club Sites</h2>
        <p>
          The League partners with libraries, schools, and community centers to host free Tech Club workshops.
        </p>
        <p class="locations__note">
          Stay up to date about upcoming Tech Club events through our Meetup page.
        </p>
        <div class="locations__links">
          <a class="button" href="https://www.meetup.com/the-league-tech-club" target="_blank" rel="noreferrer">Join Tech Club</a>
        </div>
      </article>
    </div>
  </section>

  <Section class="locations-section">
    <div class="locations-section__header">
      <h2>League Sites</h2>
      <p>League-operated classrooms and online offerings.</p>
    </div>
    <CardGrid class="locations__cards" min-width={260}>
      {leagueLocations.map((location) => (
        <LocationCard
          name={cleanLocationName(location.name)}
          address={formatAddress(location)}
          type={labelType(location.type)}
          showType={false}
        />
      ))}
    </CardGrid>
  </Section>

  <Section class="locations-section">
    <div class="locations-section__header">
      <h2>School Partners</h2>
      <p>School campuses hosting League instruction.</p>
    </div>
    <CardGrid class="locations__cards" min-width={260}>
      {schoolLocations.map((location) => (
        <LocationCard
          name={cleanLocationName(location.name)}
          address={formatAddress(location)}
          type={labelType(location.type)}
          showType={false}
        />
      ))}
    </CardGrid>
  </Section>

  <Section class="locations-section">
    <div class="locations-section__header">
      <h2>Library Partners</h2>
      <p>Public libraries partnering with Tech Club programs.</p>
    </div>
    <CardGrid class="locations__cards" min-width={260}>
      {libraryLocations.map((location) => (
        <LocationCard
          name={cleanLocationName(location.name)}
          address={formatAddress(location)}
          type={labelType(location.type)}
          showType={false}
        />
      ))}
    </CardGrid>
  </Section>

  <Section class="locations-section">
    <div class="locations-section__header">
      <h2>Other Community Sites</h2>
      <p>Additional partners supporting League workshops across San Diego.</p>
    </div>
    <CardGrid class="locations__cards" min-width={260}>
      {otherLocations.map((location) => (
        <LocationCard
          name={cleanLocationName(location.name)}
          address={formatAddress(location)}
          type={labelType(location.type, 'Other Location')}
          showType={false}
        />
      ))}
    </CardGrid>
  </Section>
</BaseLayout>

<style>
  .locations-contact {
    padding-top: var(--space-4xl);
    padding-bottom: var(--space-4xl);
    background: var(--color-surface-alt);
  }

  .locations-contact__container {
    display: grid;
    gap: var(--space-3xl);
  }

  .locations-contact__intro {
    max-width: 720px;
  }

  .locations-contact__grid {
    width: 100%;
  }

  .locations-contact__links {
    display: grid;
    gap: var(--space-xs);
  }

  .locations-contact__message {
    max-width: 720px;
  }

  .locations__feature {
    max-width: 600px;
  }

  .locations__note {
    margin: 0;
    color: var(--color-muted);
    font-size: 14px;
  }

  .locations__grid {
    display: grid;
    gap: var(--space-xl);
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  }

  .locations__links {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
  }

  .locations-section {
    padding-top: var(--space-4xl);
    padding-bottom: var(--space-4xl);
  }

  .locations-section:nth-of-type(odd) {
    background: var(--color-surface-alt);
  }

  .locations-section__header {
    max-width: 640px;
    margin: 0 auto var(--space-2xl);
    text-align: center;
  }

  .locations-section__header h2 {
    margin-bottom: var(--space-sm);
  }

  .locations-section__header p {
    margin: 0;
    color: var(--color-body);
  }

  .locations__cards {
    margin-top: var(--space-xl);
  }
</style>
