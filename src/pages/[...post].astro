---
import type { GetStaticPathsResult } from 'astro';
import { getCollection } from 'astro:content';
import PostLayout from '../layouts/PostLayout.astro';

interface RouteProps {
  Content: any;
  frontmatter: Record<string, any>;
}

export async function getStaticPaths(): Promise<GetStaticPathsResult> {
  const posts = await getCollection('posts');

  const routes = await Promise.all(
    posts.map(async (entry) => {
      const { Content } = await entry.render();

      return {
        params: { post: `news/${entry.slug}` },
        props: {
          Content,
          frontmatter: {
            ...entry.data,
            slug: entry.slug,
          },
        },
      };
    })
  );

  return routes as unknown as GetStaticPathsResult;
}

const { Content, frontmatter } = Astro.props as unknown as RouteProps;

---

<PostLayout frontmatter={frontmatter}>
  <Content />
</PostLayout>
