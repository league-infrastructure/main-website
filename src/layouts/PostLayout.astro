---
import BaseLayout from './BaseLayout.astro';
import Post from '../components/Post.astro';

interface FeaturedImage {
  src: string;
  alt?: string | null;
  caption?: string | null;
  srcset?: string | null;
  sizes?: string | null;
}

interface Frontmatter {
  title?: string | null;
  author?: string | null;
  date?: string | null;
  description?: string | null;
  featuredImage?: FeaturedImage | string | null;
  featuredImageAlt?: string | null;
}

interface Props {
  frontmatter: Frontmatter;
}

const { frontmatter } = Astro.props as Props;
const {
  title,
  author = null,
  date = null,
  description = null,
  featuredImage = null,
  featuredImageAlt = null,
} = frontmatter;

const pageTitle = title ?? 'League Update';

const normalizedFeaturedImage = (() => {
  if (!featuredImage) {
    return null;
  }

  if (typeof featuredImage === 'string') {
    return { src: featuredImage, alt: featuredImageAlt ?? pageTitle } satisfies FeaturedImage;
  }

  return {
    src: featuredImage.src,
    alt: featuredImage.alt ?? featuredImageAlt ?? pageTitle,
    caption: featuredImage.caption ?? undefined,
    srcset: featuredImage.srcset ?? undefined,
    sizes: featuredImage.sizes ?? undefined,
  } satisfies FeaturedImage;
})();

---

<BaseLayout title={pageTitle} description={description ?? undefined}>
  <Post
    title={pageTitle}
    author={author ?? undefined}
    date={date ?? undefined}
    featuredImage={normalizedFeaturedImage ?? undefined}
  >
    <slot />
  </Post>
</BaseLayout>
